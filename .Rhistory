# get sizes of all cells in raster
cell_size <- area(gcm_refugia_wgs84, na.rm=TRUE, weights=FALSE)
# delete NAs from vector of all raster cells
cell_size <- cell_size[!is.na(cell_size)]
# calculate area of all cells in raster (km squared)
raster_area <- length(cell_size) * median(cell_size)
print(paste0('Area of refugia for ', genus, ' using GCM ', gcm, ' and ', evalType, ' evaluations = ', raster_area))
thresholds <- seq(0.00001, maxValue(pollenRast), by = 0.00001)
area_comparisons <- data.frame('threshold' = thresholds, 'area' = NA)
least_difference <- gcm_area
gcm_area <- raster_area
thresholds <- seq(0.00001, maxValue(pollenRast), by = 0.00001)
area_comparisons <- data.frame('threshold' = thresholds, 'area' = NA)
least_difference <- gcm_area
for (t in thresholds) {
pollen_refugia <- pollenRast >= t
pollen_refugia_wgs84 <- projectRaster(pollen_refugia, crs='+proj=longlat +datum=WGS84')
# get sizes of all cells in raster
cell_size <- area(gcm_refugia_wgs84, na.rm=TRUE, weights=FALSE)
# delete NAs from vector of all raster cells
cell_size <- cell_size[!is.na(cell_size)]
# calculate area of all cells in raster (km squared)
pollen_area <- length(cell_size) * median(cell_size)
difference <- abs(gcm_area - pollen_area)
if(difference < least_difference) {
least_difference <- difference
t_least_difference <- t
}
area_comparisons$area[which(area_comparisons$threshold == t)] <- pollen_area
}
thresholds <- seq(0.00001, maxValue(pollenRast), by = 0.00001)
area_comparisons <- data.frame('threshold' = thresholds, 'area' = NA)
least_difference <- gcm_area
for (t in thresholds) {
pollen_refugia <- pollenRast >= t
pollen_refugia_wgs84 <- projectRaster(pollen_refugia, crs='+proj=longlat +datum=WGS84')
# get sizes of all cells in raster
cell_size <- area(gcm_refugia_wgs84, na.rm=TRUE, weights=FALSE)
# delete NAs from vector of all raster cells
cell_size <- cell_size[!is.na(cell_size)]
# calculate area of all cells in raster (km squared)
pollen_area <- length(cell_size) * median(cell_size)
difference <- abs(gcm_area - pollen_area)
if(difference < least_difference) {
least_difference <- difference
t_least_difference <- t
}
area_comparisons$area[which(area_comparisons$threshold == t)] <- pollen_area
}
print(paste0("least difference = ", least_difference))
print(paste0("threshold of least difference = ", t_least_difference))
evalTypes
gcmList
for(evalType in evalTypes) {
for(gcm in gcmList) {
# load refugia for gcm & evalType pair (gcm_refugia)
load(paste0('./workspaces/07 - Analyses, ', gcm, ' Refugia (', evalType, ')'))
gcm_refugia_wgs84 <- projectRaster(gcm_refugia, crs='+proj=longlat +datum=WGS84')
# get sizes of all cells in raster
cell_size <- area(gcm_refugia_wgs84, na.rm=TRUE, weights=FALSE)
# delete NAs from vector of all raster cells
cell_size <- cell_size[!is.na(cell_size)]
# calculate area of all cells in raster (km squared)
gcm_area <- length(cell_size) * median(cell_size)
thresholds <- seq(0.00001, maxValue(pollenRast), by = 0.00001)
area_comparisons <- data.frame('threshold' = thresholds, 'area' = NA)
least_difference <- gcm_area
for (t in thresholds) {
pollen_refugia <- pollenRast >= t
pollen_refugia_wgs84 <- projectRaster(pollen_refugia, crs='+proj=longlat +datum=WGS84')
# get sizes of all cells in raster
cell_size <- area(gcm_refugia_wgs84, na.rm=TRUE, weights=FALSE)
# delete NAs from vector of all raster cells
cell_size <- cell_size[!is.na(cell_size)]
# calculate area of all cells in raster (km squared)
pollen_area <- length(cell_size) * median(cell_size)
difference <- abs(gcm_area - pollen_area)
if(difference < least_difference) {
least_difference <- difference
t_least_difference <- t
}
area_comparisons$area[which(area_comparisons$threshold == t)] <- pollen_area
}
write.xlsx(area_comparisons, file = './pollen_area_comparison_thresholds.xlsx',
sheetName = paste0(evalType, '_', gcm),
append = T, row.names = F)
}
}
rm(list = ls())
library(data.table)
library(xlsx)
library(dplyr)
library(geosphere)
library(raster)
library(rnaturalearth)
library(enmSdm)
library(spatialEco)
library(maps)
library(sf)
library(sp)
library(dismo)
library(psych)
library(vegan)
library(viridis)
## genus constants ##
genus <- 'fraxinus'
speciesList <- paste0('Fraxinus ',
c('americana', 'caroliniana','cuspidata',
'greggii', 'nigra', 'pennsylvanica',
'profunda', 'quadrangulata'))
baseFolder <- '/Volumes/lj_mac_22/MOBOT/by_genus/'
setwd(paste0(baseFolder, genus))
ll <- c('longitude', 'latitude')
gcmList <- c('hadley','ccsm', 'ecbilt')
evalTypes <- c('geo', 'random')
model <- 'sdm'
pc <- 5
predictors <- c(paste0('pca', 1:pc))
climYears <- seq(0, -21000, by = -1000)
world <- ne_countries(scale = "medium", returnclass = "sf")
world <- as(world, "Spatial")
colors <- c('gray83', '#ccece6', '#99d8c9', '#66c2a4', '#41ae76', '#238b45', '#006d2c', '#00441b')
for(evalType in evalTypes) {
for(gcm in gcmList) {
# load refugia for gcm & evalType pair (gcm_refugia)
load(paste0('./workspaces/07 - Analyses, ', gcm, ' Refugia (', evalType, ')'))
gcm_refugia_wgs84 <- projectRaster(gcm_refugia, crs='+proj=longlat +datum=WGS84')
# get sizes of all cells in raster
cell_size <- area(gcm_refugia_wgs84, na.rm=TRUE, weights=FALSE)
# delete NAs from vector of all raster cells
cell_size <- cell_size[!is.na(cell_size)]
# calculate area of all cells in raster (km squared)
gcm_area <- length(cell_size) * median(cell_size)
thresholds <- seq(0.00001, maxValue(pollenRast), by = 0.00001)
area_comparisons <- data.frame('threshold' = thresholds, 'area' = NA)
least_difference <- gcm_area
for (t in thresholds) {
pollen_refugia <- pollenRast >= t
pollen_refugia_wgs84 <- projectRaster(pollen_refugia, crs='+proj=longlat +datum=WGS84')
# get sizes of all cells in raster
cell_size <- area(gcm_refugia_wgs84, na.rm=TRUE, weights=FALSE)
# delete NAs from vector of all raster cells
cell_size <- cell_size[!is.na(cell_size)]
# calculate area of all cells in raster (km squared)
pollen_area <- length(cell_size) * median(cell_size)
difference <- abs(gcm_area - pollen_area)
if(difference < least_difference) {
least_difference <- difference
t_least_difference <- t
}
area_comparisons$area[which(area_comparisons$threshold == t)] <- pollen_area
}
write.xlsx(area_comparisons, file = './pollen_area_comparison_thresholds.xlsx',
sheetName = paste0(evalType, '_', gcm),
append = T, row.names = F)
}
}
t <- 0.00001
pollen_refugia <- pollenRast >= t
plot(pollen_refugia)
t <- 0.05
pollen_refugia <- pollenRast >= t
plot(pollen_refugia)
for(evalType in evalTypes) {
for(gcm in gcmList) {
# load refugia for gcm & evalType pair (gcm_refugia)
load(paste0('./workspaces/07 - Analyses, ', gcm, ' Refugia (', evalType, ')'))
gcm_refugia_wgs84 <- projectRaster(gcm_refugia, crs='+proj=longlat +datum=WGS84')
# get sizes of all cells in raster
cell_size <- area(gcm_refugia_wgs84, na.rm=TRUE, weights=FALSE)
# delete NAs from vector of all raster cells
cell_size <- cell_size[!is.na(cell_size)]
# calculate area of all cells in raster (km squared)
gcm_area <- length(cell_size) * median(cell_size)
thresholds <- seq(0.00001, maxValue(pollenRast), by = 0.00001)
area_comparisons <- data.frame('threshold' = thresholds, 'area' = NA)
least_difference <- gcm_area
for (t in thresholds) {
pollen_refugia <- pollenRast >= t
pollen_refugia_wgs84 <- projectRaster(pollen_refugia, crs='+proj=longlat +datum=WGS84')
# get sizes of all cells in raster
cell_size <- area(pollen_refugia_wgs84, na.rm=TRUE, weights=FALSE)
# delete NAs from vector of all raster cells
cell_size <- cell_size[!is.na(cell_size)]
# calculate area of all cells in raster (km squared)
pollen_area <- length(cell_size) * median(cell_size)
difference <- abs(gcm_area - pollen_area)
if(difference < least_difference) {
least_difference <- difference
t_least_difference <- t
}
area_comparisons$area[which(area_comparisons$threshold == t)] <- pollen_area
}
write.xlsx(area_comparisons, file = './pollen_area_comparison_thresholds.xlsx',
sheetName = paste0(evalType, '_', gcm),
append = T, row.names = F)
}
}
for(evalType in evalTypes) {
for(gcm in gcmList) {
# load refugia for gcm & evalType pair (gcm_refugia)
load(paste0('./workspaces/07 - Analyses, ', gcm, ' Refugia (', evalType, ')'))
gcm_refugia_wgs84 <- projectRaster(gcm_refugia, crs='+proj=longlat +datum=WGS84')
# get sizes of all cells in raster
cell_size <- area(gcm_refugia_wgs84, na.rm=TRUE, weights=FALSE)
# delete NAs from vector of all raster cells
cell_size <- cell_size[!is.na(cell_size)]
# calculate area of all cells in raster (km squared)
gcm_area <- length(cell_size) * median(cell_size)
thresholds <- seq(0.00001, maxValue(pollenRast), by = 0.00001)
area_comparisons <- data.frame('threshold' = thresholds, 'area' = NA)
least_difference <- gcm_area
for (t in thresholds) {
pollen_refugia <- pollenRast >= t
pollen_refugia_wgs84 <- projectRaster(pollen_refugia, crs='+proj=longlat +datum=WGS84')
# get sizes of all cells in raster
cell_size <- area(pollen_refugia_wgs84, na.rm=TRUE, weights=FALSE)
# delete NAs from vector of all raster cells
cell_size <- cell_size[!is.na(cell_size)]
# calculate area of all cells in raster (km squared)
pollen_area <- length(cell_size) * median(cell_size)
difference <- abs(gcm_area - pollen_area)
if(difference < least_difference) {
least_difference <- difference
t_least_difference <- t
}
area_comparisons$area[which(area_comparisons$threshold == t)] <- pollen_area
}
write.xlsx(area_comparisons, file = './pollen_area_comparison_thresholds.xlsx',
sheetName = paste0(evalType, '_', gcm),
append = T, row.names = F)
}
}
rm(list = ls())
library(data.table)
library(xlsx)
library(dplyr)
library(geosphere)
library(raster)
library(rnaturalearth)
library(enmSdm)
library(spatialEco)
library(maps)
library(sf)
library(sp)
library(dismo)
library(psych)
library(vegan)
library(viridis)
## genus constants ##
genus <- 'fraxinus'
speciesList <- paste0('Fraxinus ',
c('americana', 'caroliniana','cuspidata',
'greggii', 'nigra', 'pennsylvanica',
'profunda', 'quadrangulata'))
baseFolder <- '/Volumes/lj_mac_22/MOBOT/by_genus/'
setwd(paste0(baseFolder, genus))
ll <- c('longitude', 'latitude')
gcmList <- c('hadley','ccsm', 'ecbilt')
evalTypes <- c('geo', 'random')
model <- 'sdm'
pc <- 5
predictors <- c(paste0('pca', 1:pc))
climYears <- seq(0, -21000, by = -1000)
world <- ne_countries(scale = "medium", returnclass = "sf")
world <- as(world, "Spatial")
colors <- c('gray83', '#ccece6', '#99d8c9', '#66c2a4', '#41ae76', '#238b45', '#006d2c', '#00441b')
for(evalType in evalTypes) {
for(gcm in gcmList) {
# load refugia for gcm & evalType pair (gcm_refugia)
load(paste0('./workspaces/07 - Analyses, ', gcm, ' Refugia (', evalType, ')'))
gcm_refugia_wgs84 <- projectRaster(gcm_refugia, crs='+proj=longlat +datum=WGS84')
# get sizes of all cells in raster
cell_size <- area(gcm_refugia_wgs84, na.rm=TRUE, weights=FALSE)
# delete NAs from vector of all raster cells
cell_size <- cell_size[!is.na(cell_size)]
# calculate area of all cells in raster (km squared)
gcm_area <- length(cell_size) * median(cell_size)
thresholds <- seq(0.00001, maxValue(pollenRast), by = 0.00001)
area_comparisons <- data.frame('threshold' = thresholds, 'area' = NA)
least_difference <- gcm_area
for (t in thresholds) {
pollen_refugia <- pollenRast >= t
pollen_refugia_wgs84 <- projectRaster(pollen_refugia, crs='+proj=longlat +datum=WGS84')
# get sizes of all cells in raster
cell_size <- area(pollen_refugia_wgs84, na.rm=TRUE, weights=FALSE)
# delete NAs from vector of all raster cells
cell_size <- cell_size[!is.na(cell_size)]
# calculate area of all cells in raster (km squared)
pollen_area <- length(cell_size) * median(cell_size)
difference <- abs(gcm_area - pollen_area)
if(difference < least_difference) {
least_difference <- difference
t_least_difference <- t
}
area_comparisons$area[which(area_comparisons$threshold == t)] <- pollen_area
}
write.xlsx(area_comparisons, file = './pollen_area_comparison_thresholds.xlsx',
sheetName = paste0(evalType, '_', gcm),
append = T, row.names = F)
}
}
# load refugia for gcm & evalType pair (gcm_refugia)
load(paste0('./workspaces/07 - Analyses, ', gcm, ' Refugia (', evalType, ')'))
rm(list = ls())
library(data.table)
library(xlsx)
library(dplyr)
library(geosphere)
library(raster)
library(rnaturalearth)
library(enmSdm)
library(spatialEco)
library(maps)
library(sf)
library(sp)
library(dismo)
library(psych)
library(vegan)
library(viridis)
## genus constants ##
genus <- 'fraxinus'
speciesList <- paste0('Fraxinus ',
c('americana', 'caroliniana','cuspidata',
'greggii', 'nigra', 'pennsylvanica',
'profunda', 'quadrangulata'))
baseFolder <- '/Volumes/lj_mac_22/MOBOT/by_genus/'
setwd(paste0(baseFolder, genus))
ll <- c('longitude', 'latitude')
gcmList <- c('hadley','ccsm', 'ecbilt')
evalTypes <- c('geo', 'random')
model <- 'sdm'
pc <- 5
predictors <- c(paste0('pca', 1:pc))
climYears <- seq(0, -21000, by = -1000)
world <- ne_countries(scale = "medium", returnclass = "sf")
world <- as(world, "Spatial")
colors <- c('gray83', '#ccece6', '#99d8c9', '#66c2a4', '#41ae76', '#238b45', '#006d2c', '#00441b')
evalType <- 'geo'
gcm <- 'hadley'
# load refugia for gcm & evalType pair (gcm_refugia)
load(paste0('./workspaces/07 - Analyses, ', gcm, ' Refugia (', evalType, ')'))
gcm_refugia_wgs84 <- projectRaster(gcm_refugia, crs='+proj=longlat +datum=WGS84')
plot(gcm_refugia_wgs84)
# get sizes of all cells in raster
cell_size <- area(gcm_refugia_wgs84, na.rm=TRUE, weights=FALSE)
# delete NAs from vector of all raster cells
cell_size <- cell_size[!is.na(cell_size)]
# calculate area of all cells in raster (km squared)
gcm_area <- length(cell_size) * median(cell_size)
t <- 0.0001
least_difference <- gcm_area
pollen_refugia <- pollenRast >= t
plot(pollen_refugia)
plot(pollenRast)
t <- 0.04
pollen_refugia <- pollenRast >= t
plot(pollen_refugia)
pollen_refugia_wgs84 <- projectRaster(pollen_refugia, crs='+proj=longlat +datum=WGS84')
plot(pollen_refugia_wgs84)
# get sizes of all cells in raster
cell_size <- area(pollen_refugia_wgs84, na.rm=TRUE, weights=FALSE)
# delete NAs from vector of all raster cells
cell_size <- cell_size[!is.na(cell_size)]
# calculate area of all cells in raster (km squared)
pollen_area <- length(cell_size) * median(cell_size)
# get sizes of all cells in raster
cell_size <- area(pollen_refugia_wgs84 > 0, na.rm = TRUE, weights = FALSE)
# delete NAs from vector of all raster cells
cell_size <- cell_size[!is.na(cell_size)]
# calculate area of all cells in raster (km squared)
pollen_area <- length(cell_size) * median(cell_size)
t <- 0.01
pollen_refugia <- pollenRast >= t
plot(pollen_refugia
)
pollen_refugia_wgs84 <- projectRaster(pollen_refugia, crs='+proj=longlat +datum=WGS84')
# get sizes of all cells in raster
cell_size <- area(pollen_refugia_wgs84, na.rm = TRUE, weights = FALSE)
# delete NAs from vector of all raster cells
cell_size <- cell_size[!is.na(cell_size)]
# calculate area of all cells in raster (km squared)
pollen_area <- length(cell_size) * median(cell_size)
cellStats(pollen_refugia_wgs84,function(x,...) sum(x>0))
cellStats(pollen_refugia_wgs84,function(x) sum(x > 0))
cellStats(pollen_refugia_wgs84,function(x, ...) sum(x > 0))
cellStats(pollen_refugia,function(x, ...) sum(x > 0))
plot(pollen_refugia>0)
plot(pollen_refugia > 0.01)
sum(pollen_refugia[] > 0)
sum(pollen_refugia_wgs84[] > 0)
library(raster)
raster::area(pollen_refugia_wgs84)
raster::area(pollen_refugia_wgs84, na.rm = T)
# get sizes of all cells in raster
cell_size <- area(pollen_refugia_wgs84, na.rm = TRUE)
# delete NAs from vector of all raster cells
cell_size <- cell_size[!is.na(cell_size)]
# calculate area of all cells in raster (km squared)
pollen_area <- length(cell_size) * median(cell_size)
t <- 0.06
pollen_refugia <- pollenRast >= t
pollen_refugia_wgs84 <- projectRaster(pollen_refugia, crs='+proj=longlat +datum=WGS84')
# get sizes of all cells in raster
cell_size <- area(pollen_refugia_wgs84, na.rm = TRUE)
# delete NAs from vector of all raster cells
cell_size <- cell_size[!is.na(cell_size)]
# calculate area of all cells in raster (km squared)
pollen_area <- length(cell_size) * median(cell_size)
cell_size <- area(pollen_refugia, na.rm = TRUE)
pollen_refugia <- reclassify(pollen_refugia, c(-Inf,0,0))
pollen_refugia <- reclassify(pollen_refugia, c(0, +Inf, 1))
plot(pollen_refugia)
t
sum(pollen_refugia)
calc(pollen_refugia, fun=sum)
cellStats(pollen_refugia, 'sum')
pollen_refugia_wgs84 <- projectRaster(pollen_refugia, crs='+proj=longlat +datum=WGS84')
cellStats(pollen_refugia_wgs84, 'sum')
cellStats(pollen_refugia, 'sum')
# calculate area of all cells in raster (km squared)
gcm_area <- cellStats(gcm_refugia, 'sum')
for(evalType in evalTypes) {
for(gcm in gcmList) {
# load refugia for gcm & evalType pair (gcm_refugia)
load(paste0('./workspaces/07 - Analyses, ', gcm, ' Refugia (', evalType, ')'))
# calculate area of all cells in raster (km squared)
gcm_area <- cellStats(gcm_refugia, 'sum')
thresholds <- seq(0.00001, maxValue(pollenRast), by = 0.00001)
area_comparisons <- data.frame('threshold' = thresholds, 'area' = NA)
least_difference <- gcm_area
for (t in thresholds) {
pollen_refugia <- pollenRast >= t
# calculate area of all cells in raster (km squared)
pollen_area <- cellStats(pollen_refugia, 'sum')
difference <- abs(gcm_area - pollen_area)
if(difference < least_difference) {
least_difference <- difference
t_least_difference <- t
}
area_comparisons$area[which(area_comparisons$threshold == t)] <- pollen_area
}
write.xlsx(area_comparisons, file = './pollen_area_comparison_thresholds.xlsx',
sheetName = paste0(evalType, '_', gcm),
append = T, row.names = F)
}
}
t <- 0.01
pollen_refugia <- pollenRast >= t
# calculate area of all cells in raster (km squared)
pollen_area <- cellStats(pollen_refugia, 'sum')
t <- 0.06
pollen_refugia <- pollenRast >= t
# calculate area of all cells in raster (km squared)
pollen_area <- cellStats(pollen_refugia, 'sum')
difference <- abs(gcm_area - pollen_area)
least_difference <- gcm_area
if(difference < least_difference) {
least_difference <- difference
t_least_difference <- t
}
area_comparisons <- data.frame('threshold' = thresholds, 'area' = NA)
area_comparisons$area[which(area_comparisons$threshold == t)] <- pollen_area
View(area_comparisons)
area_comparisons$area[which(area_comparisons$threshold == 0.06000)] <- pollen_area
which(area_comparisons$threshold == 0.06000)
which(area_comparisons$threshold == 0.06)
which(area_comparisons$threshold == t)
which(grepl(t, area_comparisons$threshold))
which(area_comparisons$threshold == 3)
which(area_comparisons$threshold == t)
which(area_comparisons$threshold == 0.06)
area_comparisons <- data.frame('threshold' = as.double(thresholds), 'area' = NA)
which(area_comparisons$threshold == t)
t
which(area_comparisons$threshold == as.double(t))
as.double(t)
which(as.double(area_comparisons$threshold) == as.double(t))
t x 1000
t*1000
t*100000
area_comparisons$area[1] <- pollen_area
1e^5
1*10*5
t * 100000
area$comparisons$threshold[t * 100000]
area_comparisons$threshold[t * 100000]
for(evalType in evalTypes) {
for(gcm in gcmList) {
# load refugia for gcm & evalType pair (gcm_refugia)
load(paste0('./workspaces/07 - Analyses, ', gcm, ' Refugia (', evalType, ')'))
# calculate area of all cells in raster (km squared)
gcm_area <- cellStats(gcm_refugia, 'sum')
thresholds <- seq(0.00001, maxValue(pollenRast), by = 0.00001)
area_comparisons <- data.frame('threshold' = as.double(thresholds), 'area' = NA)
least_difference <- gcm_area
for (t in thresholds) {
pollen_refugia <- pollenRast >= t
# calculate area of all cells in raster (km squared)
pollen_area <- cellStats(pollen_refugia, 'sum')
difference <- abs(gcm_area - pollen_area)
if(difference < least_difference) {
least_difference <- difference
t_least_difference <- t
}
area_comparisons$area[t * 100000] <- pollen_area
}
write.xlsx(area_comparisons, file = './pollen_area_comparison_thresholds.xlsx',
sheetName = paste0(evalType, '_', gcm),
append = T, row.names = F)
}
}
